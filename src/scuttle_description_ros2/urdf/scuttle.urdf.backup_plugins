<?xml version="1.0" ?>
<robot name="scuttle" xmlns:xacro="http://www.ros.org/wiki/xacro">

<!-- Materials from materials.xacro -->
<material name="silver">
  <color rgba="0.700 0.700 0.700 1.000"/>
</material>

<material name="gray">
  <color rgba="0.250 0.250 0.250 1.000"/>
</material>

<material name="blue">
  <color rgba="0.000 0.000 0.700 1.000"/>
</material>

<material name="black">
  <color rgba="0.000 0.000 0.000 1.000"/>
</material>

<!-- Transmissions from scuttle.trans -->
<transmission name="l_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="l_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="l_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="r_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="r_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="r_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="r_caster_swivel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="r_caster_swivel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="r_caster_swivel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="l_caster_swivel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="l_caster_swivel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="l_caster_swivel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="r_caster_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="r_caster_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="r_caster_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="l_caster_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="l_caster_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="l_caster_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<!-- Gazebo plugins from scuttle.gazebo -->
<xacro:property name="body_color" value="Gazebo/Silver" />
<xacro:property name="wheel_color" value="Gazebo/Blue" />
<xacro:property name="lidar_color" value="Gazebo/Gray" />

<xacro:arg name="differential_drive_command_topic" default="cmd_vel"/>
<xacro:arg name="differential_drive_odometry_topic" default="odom"/>
<xacro:arg name="differential_drive_odometry_frame" default="odom"/>
<!--
<gazebo>
  <plugin filename="libgazebo_ros_control.so" name="control"/>
</gazebo> 
-->
<rosDebugLevel>na</rosDebugLevel>
<publishOdomTF>true</publishOdomTF>
<gazebo reference="base_link">
  <material>${body_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
  <gravity>true</gravity>
</gazebo>

<gazebo reference="l_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.9</mu1>
  <mu2>0.9</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="r_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.9</mu1>
  <mu2>0.9</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="lidar_1">
  <material>${lidar_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="r_caster_swivel_1">
  <material>${body_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="l_caster_swivel_1">
  <material>${body_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="l_caster_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.4</mu1>
  <mu2>0.4</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="r_caster_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.4</mu1>
  <mu2>0.4</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo>
  <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">

    <!-- Plugin update rate in Hz -->
    <updateRate>50</updateRate>

    <!-- Name of left joint, defaults to `left_joint` -->
    <leftJoint>l_wheel_joint</leftJoint>

    <!-- Name of right joint, defaults to `right_joint` -->
    <rightJoint>r_wheel_joint</rightJoint>

    <!-- The distance from the center of one wheel to the other, in meters, defaults to 0.34 m -->
    <wheelSeparation>0.355</wheelSeparation>

    <!-- Diameter of the wheels, in meters, defaults to 0.15 m -->
    <wheelDiameter>0.0833</wheelDiameter>

    <!-- Wheel acceleration, in rad/s^2, defaults to 0.0 rad/s^2 -->
    <wheelAcceleration>2.7</wheelAcceleration>

    <!-- Maximum torque which the wheels can produce, in Nm, defaults to 5 Nm -->
    <wheelTorque>0.392</wheelTorque>

    <!-- Topic to receive geometry_msgs/Twist message commands, defaults to `cmd_vel` -->
    <commandTopic>cmd_vel</commandTopic>

    <!-- Topic to publish nav_msgs/Odometry messages, defaults to `odom` -->
    <odometryTopic>odom</odometryTopic>

    <!-- Odometry frame, defaults to `odom` -->
    <odometryFrame>odom</odometryFrame>

    <!-- Robot frame to calculate odometry from, defaults to `base_footprint` -->
    <robotBaseFrame>base_link</robotBaseFrame>

    <!-- Odometry source, 0 for ENCODER, 1 for WORLD, defaults to WORLD -->
    <odometrySource>1</odometrySource>

    <!-- Set to true to publish transforms for the wheel links, defaults to false -->
    <publishWheelTF>false</publishWheelTF>

    <!-- Set to true to publish transforms for the odometry, defaults to true -->
    <publishOdom>true</publishOdom>

    <!-- Set to true to publish sensor_msgs/JointState on /joint_states for the wheel joints, defaults to false -->
    <publishWheelJointState>false</publishWheelJointState>

    <!-- Set to true to swap right and left wheels, defaults to true -->
    <legacyMode>false</legacyMode>
  </plugin>
</gazebo>

 <gazebo reference="lidar_1">
    <sensor type="ray" name="rplidar_a1">
      <pose>0 0 0 0 0 0</pose>
      <visualize>false</visualize>
      <update_rate>5.5</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>0</min_angle>
            <max_angle>6.283185307179586</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.15</min>
          <max>12.0</max>
          <resolution>0.005</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <!-- Noise parameters based on published spec for Hokuyo laser
               achieving "+-30mm" accuracy at range < 10m.  A mean of 0.0m and
               stddev of 0.01m will put 99.7% of samples within 0.03m of the true
               reading. -->
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="gazebo_ros_head_hokuyo_controller" filename="libgazebo_ros_laser.so">
        <topicName>/scan</topicName>
        <frameName>lidar_1</frameName>
      </plugin>
    </sensor>
  </gazebo>


<!-- BEGIN: Inlined from scuttle.trans -->
<transmission name="l_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="l_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="l_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="r_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="r_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="r_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="r_caster_swivel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="r_caster_swivel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="r_caster_swivel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="l_caster_swivel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="l_caster_swivel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="l_caster_swivel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="r_caster_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="r_caster_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="r_caster_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="l_caster_wheel_joint_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="l_caster_wheel_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="l_caster_wheel_joint_actr">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<!-- BEGIN: Inlined from scuttle.gazebo -->
<xacro:property name="body_color" value="Gazebo/Silver" />
<xacro:property name="wheel_color" value="Gazebo/Blue" />
<xacro:property name="lidar_color" value="Gazebo/Gray" />

<xacro:arg name="differential_drive_command_topic" default="cmd_vel"/>
<xacro:arg name="differential_drive_odometry_topic" default="odom"/>
<xacro:arg name="differential_drive_odometry_frame" default="odom"/>
<!--
<gazebo>
  <plugin filename="libgazebo_ros_control.so" name="control"/>
</gazebo> 
-->
<rosDebugLevel>na</rosDebugLevel>
<publishOdomTF>true</publishOdomTF>
<gazebo reference="base_link">
  <material>${body_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
  <gravity>true</gravity>
</gazebo>

<gazebo reference="l_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.9</mu1>
  <mu2>0.9</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="r_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.9</mu1>
  <mu2>0.9</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="lidar_1">
  <material>${lidar_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="r_caster_swivel_1">
  <material>${body_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="l_caster_swivel_1">
  <material>${body_color}</material>
  <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="l_caster_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.4</mu1>
  <mu2>0.4</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo reference="r_caster_wheel_1">
  <material>${wheel_color}</material>
  <mu1>0.4</mu1>
  <mu2>0.4</mu2>
  <selfCollide>true</selfCollide>
</gazebo>

<gazebo>
  <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">

    <!-- Plugin update rate in Hz -->
    <updateRate>50</updateRate>

    <!-- Name of left joint, defaults to `left_joint` -->
    <leftJoint>l_wheel_joint</leftJoint>

    <!-- Name of right joint, defaults to `right_joint` -->
    <rightJoint>r_wheel_joint</rightJoint>

    <!-- The distance from the center of one wheel to the other, in meters, defaults to 0.34 m -->
    <wheelSeparation>0.355</wheelSeparation>

    <!-- Diameter of the wheels, in meters, defaults to 0.15 m -->
    <wheelDiameter>0.0833</wheelDiameter>

    <!-- Wheel acceleration, in rad/s^2, defaults to 0.0 rad/s^2 -->
    <wheelAcceleration>2.7</wheelAcceleration>

    <!-- Maximum torque which the wheels can produce, in Nm, defaults to 5 Nm -->
    <wheelTorque>0.392</wheelTorque>

    <!-- Topic to receive geometry_msgs/Twist message commands, defaults to `cmd_vel` -->
    <commandTopic>cmd_vel</commandTopic>

    <!-- Topic to publish nav_msgs/Odometry messages, defaults to `odom` -->
    <odometryTopic>odom</odometryTopic>

    <!-- Odometry frame, defaults to `odom` -->
    <odometryFrame>odom</odometryFrame>

    <!-- Robot frame to calculate odometry from, defaults to `base_footprint` -->
    <robotBaseFrame>base_link</robotBaseFrame>

    <!-- Odometry source, 0 for ENCODER, 1 for WORLD, defaults to WORLD -->
    <odometrySource>1</odometrySource>

    <!-- Set to true to publish transforms for the wheel links, defaults to false -->
    <publishWheelTF>false</publishWheelTF>

    <!-- Set to true to publish transforms for the odometry, defaults to true -->
    <publishOdom>true</publishOdom>

    <!-- Set to true to publish sensor_msgs/JointState on /joint_states for the wheel joints, defaults to false -->
    <publishWheelJointState>false</publishWheelJointState>

    <!-- Set to true to swap right and left wheels, defaults to true -->
    <legacyMode>false</legacyMode>
  </plugin>
</gazebo>

 <gazebo reference="lidar_1">
    <sensor type="ray" name="rplidar_a1">
      <pose>0 0 0 0 0 0</pose>
      <visualize>false</visualize>
      <update_rate>5.5</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>0</min_angle>
            <max_angle>6.283185307179586</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.15</min>
          <max>12.0</max>
          <resolution>0.005</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <!-- Noise parameters based on published spec for Hokuyo laser
               achieving "+-30mm" accuracy at range < 10m.  A mean of 0.0m and
               stddev of 0.01m will put 99.7% of samples within 0.03m of the true
               reading. -->
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="gazebo_ros_head_hokuyo_controller" filename="libgazebo_ros_laser.so">
        <topicName>/scan</topicName>
        <frameName>lidar_1</frameName>
      </plugin>
    </sensor>
  </gazebo>



    <!--
      An empty base link for the following reasons:
      - When running a simulation the base link is not allowed to have inertia, but the chassis does need to have
        its inertia defined. So the fix is to define a 'dummy' base link.
    -->
    <link name="base_link">
    </link>


    <!--
        A box that pretends to be the ground. Used for testing that the scuttle model has been assembled correctly.
    -->
    <!--
    <link name="ground_for_testing">
        <visual>
            <geometry>
                <box size="0.5 0.5 0.01"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0.25 -0.25 -0.005"/>
        </visual>
    </link>
    -->


    <!-- The chassis of scuttle -->
    <!--
        Define the connection between base_link and chassis_link. Relative to base_link the joint
        is exactly in the c.o.g of the chassis, because ROS considers the joint frame to be the same
        as the child frame.
    -->
    <joint name="chassis_joint" type="fixed">
        <origin rpy="0 0 0" xyz="0.10539999389648432 0 0.084749938964843793"/>
        <parent link="base_link"/>
        <child link="chassis_link"/>
    </joint>


    <!--
      The coordinate framework has the X-asis in the direction of forward motion, with the y-axis pointing
      to the left. This is equivalent to the coordinate system defined by the scuttle kinematics guide.
    -->
    <link name="chassis_link">
        <inertial>
            <origin rpy="0 0 0" xyz="0.1 0 0.07392564365565002"/>
            <mass value="3.288323846275119"/>
            <inertia ixx="0.038876" ixy="1.3e-05" ixz="1e-06" iyy="0.047513" iyz="0.000486" izz="0.084083"/>
        </inertial>
        <visual>
            <!--
                The origin of the STL mesh is the center of gravity of the aluminium frame (excluding the
                motors etc.). To get it to the correct location it needs to be moved slightly forward and
                slightly up.
            -->
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <!--
                    The visual mesh is a high definition mesh for visual purposes only.


                    Note that the STL mesh is dimensioned in millimeters
                -->
                <mesh filename="package://scuttle_description_ros2/meshes/chassis_link.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="silver"/>
        </visual>
        <collision>
            <!--
                The origin of the STL mesh is the center of gravity of the aluminium frame (excluding the
                motors etc.). To get it to the correct location it needs to be moved slightly forward and
                slightly up.
            -->
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <!--
                    The collision mesh is a low definition mesh for collision calculation purposes. It only
                    describes the outer boundaries of the scuttle chassis.


                    Note that the STL mesh is dimensioned in millimeters
                -->
                <mesh filename="package://scuttle_description_ros2/meshes/chassis_link_collision.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!--
        The left rear wheel. This includes the sprocket for the drive belt.
    -->
    <joint name="l_wheel_joint" type="continuous">
        <origin rpy="0 0 1.570796" xyz="-0.10539999389648432 0.21235 -0.043"/>
        <parent link="chassis_link"/>
        <child link="l_wheel"/>
        <axis xyz="1.0 -0.0 0.0"/>
    </joint>


    <link name="l_wheel">
        <inertial>
            <origin rpy="0 0 0" xyz="-0.020325481156161784 -9.763736334427187e-09 4.516951403188418e-09"/>
            <mass value="0.5928646271111422"/>
            <inertia ixx="0.000334" ixy="0.0" ixz="-0.0" iyy="0.000332" iyz="-0.0" izz="0.000332"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="-0.21235 -0.0 -0.04175"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/l_wheel_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="blue"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="-0.21235 -0.0 -0.04175"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/l_wheel_collision_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!--
        The right rear wheel. This includes the sprocket for the drive belt.
    -->
    <joint name="r_wheel_joint" type="continuous">
        <origin rpy="0 0 1.570796" xyz="-0.10539999389648432 -0.21235 -0.043"/>
        <parent link="chassis_link"/>
        <child link="r_wheel"/>
        <axis xyz="1.0 0.0 -0.0"/>
    </joint>


    <link name="r_wheel">
        <inertial>
            <origin rpy="0 0 0" xyz="0.020325563043213257 1.3954236146756306e-08 2.0353343177514915e-09"/>
            <mass value="0.592867092340216"/>
            <inertia ixx="0.000334" ixy="0.0" ixz="0.0" iyy="0.000332" iyz="-0.0" izz="0.000332"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="0.21215 0.0 -0.04175"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/r_wheel_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="blue"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="0.21215 0.0 -0.04175"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/r_wheel_collision_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!--
        The swivel unit for the left caster
    -->
    <joint name="l_caster_swivel_joint" type="continuous">
        <origin rpy="0 0 1.570796" xyz="0.149015 0.119015 -0.025468"/>
        <parent link="chassis_link"/>
        <child link="l_caster_swivel"/>
        <axis xyz="0.0 0.0 1.0"/>
    </joint>


    <link name="l_caster_swivel">
        <inertial>
            <origin rpy="0 0 0" xyz="-0.0002554502352885568 0.010633952722858359 -0.012968467515129908"/>
            <mass value="0.02074189648802402"/>
            <inertia ixx="7e-06" ixy="0.0" ixz="0.0" iyy="8e-06" iyz="1e-06" izz="9e-06"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="0.119279 0.254415 -0.059282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/r_caster_swivel_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="silver"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="0.119279 0.254415 -0.059282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/r_caster_swivel_collision_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!--
        The wheel for the left caster
    -->
    <joint name="l_caster_wheel_joint" type="continuous">
        <origin rpy="0 0 0" xyz="-0.017792 0.024 -0.034"/>
        <parent link="l_caster_swivel"/>
        <child link="l_caster_wheel"/>
        <axis xyz="1.0 0.0 -0.0"/>
    </joint>


    <link name="l_caster_wheel">
        <inertial>
            <origin rpy="0 0 0" xyz="0.0160002016389222 -1.6368916427866864e-07 -7.02880924990934e-08"/>
            <mass value="0.03841110590847018"/>
            <inertia ixx="1.2e-05" ixy="0.0" ixz="-0.0" iyy="7e-06" iyz="0.0" izz="7e-06"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="-0.101223 0.230415 -0.025282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/l_caster_wheel_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="blue"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="-0.101223 0.230415 -0.025282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/l_caster_wheel_collision_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!--
        The swivel unit for the right caster
    -->
    <joint name="r_caster_swivel_joint" type="continuous">
        <origin rpy="0 0 1.570796" xyz="0.149015 -0.119015 -0.025468"/>
        <parent link="chassis_link"/>
        <child link="r_caster_swivel"/>
        <axis xyz="0.0 -0.0 1.0"/>
    </joint>


    <link name="r_caster_swivel">
        <inertial>
            <origin rpy="0 0 0" xyz="-0.00025520971284771765 0.010633952722903461 -0.012968467515129777"/>
            <mass value="0.02074189648802399"/>
            <inertia ixx="7e-06" ixy="0.0" ixz="0.0" iyy="8e-06" iyz="1e-06" izz="9e-06"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="-0.119015 0.254415 -0.059282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/l_caster_swivel_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="silver"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="-0.119015 0.254415 -0.059282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/l_caster_swivel_collision_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!--
        The wheel for the right caster
    -->
    <joint name="r_caster_wheel_joint" type="continuous">
        <origin rpy="0 0 0" xyz="0.014208 0.024 -0.034"/>
        <parent link="r_caster_swivel"/>
        <child link="r_caster_wheel"/>
        <axis xyz="-1.0 -0.0 0.0"/>
    </joint>


    <link name="r_caster_wheel">
        <inertial>
            <origin rpy="0 0 0" xyz="-0.016000038883518655 -1.6368920854881175e-07 -7.028809271419911e-08"/>
            <mass value="0.03841110590847031"/>
            <inertia ixx="1.2e-05" ixy="-0.0" ixz="0.0" iyy="7e-06" iyz="0.0" izz="7e-06"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="0.105071 0.230415 -0.025282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/r_caster_wheel_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="blue"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="0.105071 0.230415 -0.025282"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/r_caster_wheel_collision_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!--
        The LIDAR unit. This is attached to the rear extrusion on the chassis.
    -->
    <joint name="lidar" type="fixed">
        <origin rpy="0 0 3.141592" xyz="-0.077900 0.0 0.024850"/>
        <parent link="chassis_link"/>
        <child link="lidar_1"/>
    </joint>


    <link name="lidar_1">
        <inertial>
            <origin rpy="0 0 0" xyz="-0.0010241190327231165 -0.0008953477993804172 0.009594767416774092"/>
            <mass value="0.07327266108520486"/>
            <inertia ixx="2.5e-05" ixy="1e-06" ixz="0.0" iyy="2.5e-05" iyz="0.0" izz="4.4e-05"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="-0.0 0.0275 -0.1096"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/lidar_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="gray"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="-0.0 0.0275 -0.1096"/>
            <geometry>
                <mesh filename="package://scuttle_description_ros2/meshes/lidar_1.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>


    <!-- ===================== CAMERA SUPPORT STICK + MOVABLE CAMERA ===================== -->


    <!-- Support pole link fixed to chassis -->
    <joint name="camera_stick_joint" type="fixed">
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <parent link="chassis_link"/>
        <child link="camera_stick_link"/>
    </joint>


    <link name="camera_stick_link">
        <inertial>
            <origin xyz="0 0 0.45" rpy="0 0 0"/>
            <mass value="0.9"/>
            <inertia ixx="0.0005" ixy="0.0" ixz="0.0" iyy="0.0005" iyz="0.0" izz="0.0005"/>
        </inertial>
        <visual>
            <origin xyz="0 0 0.45" rpy="0 0 0"/>
            <geometry>
                <cylinder length="0.9" radius="0.01"/>
            </geometry>
            <material name="gray"/>
        </visual>
        <collision>
            <origin xyz="0 0 0.45" rpy="0 0 0"/>
            <geometry>
                <cylinder length="0.9" radius="0.01"/>
            </geometry>
        </collision>
    </link>


    <!-- ========== PRISMATIC JOINT FOR VERTICAL CAMERA MOVEMENT ========== -->
    <!-- This allows the camera to slide up and down the rod -->
    <joint name="camera_slider_joint" type="prismatic">
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <parent link="camera_stick_link"/>
        <child link="camera_slider_link"/>
        <axis xyz="0 0 1"/>  <!-- vertical axis (Z) -->
        <limit lower="0.1" upper="0.85" effort="10.0" velocity="0.5"/>  <!-- movement range along rod -->
        <dynamics damping="0.7" friction="0.1"/>
    </joint>


    <!-- Intermediate link that slides along the rod -->
    <link name="camera_slider_link">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.05"/>
            <inertia ixx="0.00001" ixy="0.0" ixz="0.0"
                     iyy="0.00001" iyz="0.0" izz="0.00001"/>
        </inertial>
        <!-- Small visual collar to show slider position -->
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder length="0.02" radius="0.015"/>
            </geometry>
            <material name="gray"/>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder length="0.02" radius="0.015"/>
            </geometry>
        </collision>
    </link>


    <!-- Attach camera link to the slider -->
    <joint name="camera_on_slider_joint" type="fixed">
        <origin xyz="0 0 0.01" rpy="0 0 1.5708"/>  <!-- camera rotated 90Â° -->
        <parent link="camera_slider_link"/>
        <child link="camera_link"/>
    </joint>


    <!-- Camera body link -->
    <link name="camera_link">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.1"/>
            <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
                     iyy="0.0001" iyz="0.0" izz="0.0001"/>
        </inertial>


        <visual>
            <origin xyz="0 0 0.025" rpy="0 0 0"/>
            <geometry>
                <box size="0.05 0.05 0.05"/>
            </geometry>
            <material name="black"/>
        </visual>


        <collision>
            <origin xyz="0 0 0.025" rpy="0 0 0"/>
            <geometry>
                <box size="0.05 0.05 0.05"/>
            </geometry>
        </collision>
    </link>


    <!-- Gazebo camera sensor plugin attached to camera_link -->
    <gazebo reference="camera_link">
        <sensor type="camera" name="scuttle_camera">
            <always_on>1</always_on>
            <update_rate>30</update_rate>
            <visualize>true</visualize>


            <camera>
                <horizontal_fov>1.047</horizontal_fov> <!-- ~60 degrees -->
                <image>
                    <width>640</width>
                    <height>480</height>
                    <format>R8G8B8</format>
                </image>
                <clip>
                    <near>0.05</near>
                    <far>100.0</far>
                </clip>
            </camera>


            <plugin name="gazebo_ros_camera" filename="libgazebo_ros_camera.so">
                <ros>
                  <namespace>/</namespace>
                  <remapping>image_raw:=camera/image_raw</remapping>
                  <remapping>camera_info:=camera/camera_info</remapping>
                </ros>
                <camera_name>camera</camera_name>
                <frame_name>camera_optical_frame</frame_name>
                <hack_baseline>0.07</hack_baseline>
            </plugin>
        </sensor>
    </gazebo>

    <!-- Optical frame for camera (TF-friendly) -->
    <link name="camera_optical_frame"/>
    <joint name="camera_optical_joint" type="fixed">
        <origin xyz="0 0 0.01" rpy="0 0 0"/>
        <parent link="camera_link"/>
        <child link="camera_optical_frame"/>
    </joint>
    
    <transmission name="camera_slider_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="camera_slider_joint">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        </joint>
        <actuator name="camera_slider_motor">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>


    <gazebo>
        <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
            <robotNamespace>/</robotNamespace>
        </plugin>
    </gazebo>
</robot>